<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Endless Runner ‚Äî Game PC - Buatan YahyaIXA üòé </title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg-1:#061022; --bg-2:#0f1724; --accent:#3b82f6;
    --muted:rgba(230,238,248,0.75);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:"Poppins",system-ui, sans-serif;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(59,130,246,0.06), transparent),
               linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color:#e6eef8;overflow-x:hidden}
  body::before{content:"";position:fixed;inset:0;z-index:0;
    background-image:radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size:50px 50px; opacity:0.9; pointer-events:none; mix-blend-mode:overlay;
    animation:drift 40s linear infinite}
  @keyframes drift{from{transform:translateY(0)}to{transform:translateY(-120px)}}
  .wrap{position:relative;z-index:2;max-width:980px;margin:28px auto;padding:18px;text-align:center}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);padding:12px 18px;border-radius:14px;
    box-shadow:0 6px 30px rgba(2,6,23,0.6);backdrop-filter:blur(6px)}
  h1{font-size:18px;margin:0;text-align:left;color:#f8fafc;font-weight:600}
  h1 small{font-weight:400;display:block;color:var(--muted);margin-top:4px;font-size:12px}
  .controls{display:flex;gap:10px;align-items:center}
  .scoreboard{display:flex;gap:12px;align-items:center;font-size:14px;color:var(--muted);
    padding:6px 10px;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .scoreboard strong{color:#fff;font-weight:700;margin-left:6px}
  button{background:linear-gradient(180deg,#0c1622,#07121a);color:#e6eef8;border:none;padding:8px 14px;border-radius:10px;cursor:pointer;font-size:14px;font-weight:600;transition:all .18s;display:inline-flex;gap:8px;align-items:center;box-shadow:0 6px 18px rgba(3,64,120,0.08)}
  button.primary{background:linear-gradient(90deg,var(--accent),#2563eb);color:#fff;box-shadow:0 8px 26px rgba(37,99,235,0.18)}
  button:hover{transform:translateY(-3px)}
  .game-wrap{position:relative;margin-top:20px}
  canvas#game{display:block;margin:0 auto;background:linear-gradient(180deg,#05233a,#031a2c);border-radius:16px;box-shadow:0 12px 40px rgba(2,6,23,0.7);max-width:100%;width:900px;height:300px}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    pointer-events:none;transition:opacity .3s ease-in-out;opacity:0}
  .panel{pointer-events:auto;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.05);padding:22px;border-radius:12px;text-align:center;box-shadow:0 12px 30px rgba(0,0,0,0.6); transition: opacity .4s ease-in-out;}
  .panel h2{margin:0 0 8px;font-size:20px;color:#fff}
  .panel p{margin:0 0 12px;color:var(--muted);font-size:14px}
  .small{opacity:0.85;font-size:14px;margin-top:12px;color:var(--muted)}
  footer{margin-top:18px;font-size:14px;color:rgba(230,238,248,0.75);text-align:center}
  @media(max-width:700px){header{flex-direction:column;align-items:center;gap:8px;text-align:center}h1{font-size:16px;text-align:center}canvas#game{width:100% !important;height:auto}}
  </style>
</head>
<body>
 <div class="wrap">
  <header>
    <div style="text-align:left">
      <h1>üèÉ‚Äç‚ôÇÔ∏è Endless Runner ‚Äî Tekan Spasi untuk lompat <br><small>Dibuat oleh <strong>yahyaIXA üòé</strong></small></h1>
    </div>

    <div class="controls">
      <div class="scoreboard" title="Score dan Highscore">
        <span>Score: <strong id="score">0</strong></span>
        <span>High: <strong id="high">0</strong></span>
      </div>
      <button id="btn-start" class="primary">üîÅ Mulai / Restart</button>
      <button id="btn-mute" title="Mute (belum aktif)">üîà</button>
    </div>
  </header>

   <div class="game-wrap" style="margin-top:18px;">
    <canvas id="game" width="900" height="300"></canvas>

    <div class="overlay" id="overlay"> 
      
      <div class="panel" id="overlay-panel" style="display:none; opacity:1; padding:0;"> 
        <video id="gameover-video" width="900" height="300" muted playsinline style="display:none; width:900px; height:300px; max-width:100%; object-fit: cover;">
            <source src="gameover.mp4" type="video/mp4">
            Maaf, browser Anda tidak mendukung tag video.
        </video>
        
        <div id="text-content" style="padding:22px;"> <h2 id="overlay-title">Siap bermain?</h2>
            <p id="overlay-text">Tekan <strong>Space</strong> atau klik "Mulai / Restart" untuk mulai. Gunakan ‚Üë untuk lompat dan ‚Üì untuk turun.</p>
            
            <div id="button-wrap" style="display:flex;gap:8px;justify-content:center;">
              <button id="overlay-start" class="primary">Mulai</button>
              <button id="overlay-how" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Cara Main</button>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div class="small" style="margin-top:12px;">
    üéÆ Kontrol: <strong>Spasi</strong> / <strong>Panah Atas</strong> = Lompat, <strong>Panah Bawah</strong> = Turun ‚Äî Cocok untuk dimainkan di <strong>PC</strong>.
  </div>

  <footer>
    <div class="small">Dibuat dengan <strong>HTML5 Canvas + JavaScript</strong> ‚Äî Simpel, ringan, dan seru!</div>
  </footer>
 </div>

<hr style="margin:40px auto;width:60%;border:0;border-top:1px solid rgba(255,255,255,0.08)">

<div style="text-align:center;font-size:16px;color:rgba(230,238,248,0.75);">
  <p>üß© Coba mainkan game lainnya: <strong>Puzzle Sederhana</strong><br><em>Hati-hati... nanti bisa ketagihan üòÜ</em></p>
  <a href="pazel.index.html"><button style="margin-top:8px;">Main Sekarang juga!</button></a>
</div>

<script>
/* ====== Game logic (Final Version with Video, Countdown, and Full-Screen Overlay) ====== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

let running = false;
let countdown = 0; 
let score = 0;
let highScore = Number(localStorage.getItem('endless_high') || 0);

// Safe DOM references
const scoreEl = document.getElementById('score');
const highEl = document.getElementById('high');
const btnStart = document.getElementById('btn-start');
const overlay = document.getElementById('overlay');
const overlayStart = document.getElementById('overlay-start');
const overlayTitle = document.getElementById('overlay-title');
const overlayText = document.getElementById('overlay-text');

// Panel elements
const gamePanel = document.getElementById('overlay-panel'); 
const gameoverVideo = document.getElementById('gameover-video'); 
const textContent = document.getElementById('text-content'); // Referensi wrapper teks/tombol (NEW)

if (scoreEl) scoreEl.textContent = score;
if (highEl) highEl.textContent = highScore;

// player & world
const player = { x:80, y: H - 70, w:40, h:48, vy:0, gravity:0.9, jumpPower:15, grounded:true, crouch:false };
const groundY = H - 20;
let obstacles = [];
let spawnTimer = 0;
let speed = 6;

// input
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.code] = true;
  // Memulai game saat overlay aktif dan tombol ditekan (hanya dari panel Siap Bermain/Game Over)
  if (!running && gamePanel.style.display !== 'none' && (e.code === 'Space' || e.code === 'ArrowUp')) {
      startGame();
  }
  if (['Space','ArrowUp','ArrowDown'].includes(e.code)) e.preventDefault();
});
window.addEventListener('keyup', e => { keys[e.code] = false; });

// btn events
btnStart.addEventListener('click', startGame);
overlayStart.addEventListener('click', startGame);
document.getElementById('overlay-how').addEventListener('click', ()=> {
  alert('Cara main: Tekan Spasi atau Panah Atas untuk lompat. Panah Bawah untuk turun saat di tanah.');
});


// Game Logic Functions

function resetGame(){
  score = 0; if (scoreEl) scoreEl.textContent = score;
  obstacles = [];
  spawnTimer = 60 + Math.floor(Math.random()*90);
  speed = 6;
  player.y = H - 70; player.vy = 0; player.grounded = true; player.crouch = false;
}

function startGame(){
  resetGame();
  hideOverlay();
  
  // Pastikan elemen Game Over disembunyikan dan padding panel kembali normal
  gamePanel.style.padding = '22px'; // Kembalikan padding normal
  textContent.style.display = 'block';
  if (gameoverVideo) gameoverVideo.style.display = 'none';

  // Inisialisasi hitungan mundur 3 detik (180 frame)
  countdown = 180;
  running = false; 
}

function hideOverlay(){
  overlay.style.pointerEvents = 'none';
  overlay.style.opacity = '0';
  gamePanel.style.display = 'none';
}

function gameOver(){
  running = false;
  if (score > highScore){
    highScore = score;
    localStorage.setItem('endless_high', highScore);
    if (highEl) highEl.textContent = highScore;
  }
  
  // 1. Tampilkan Overlay
  overlay.style.pointerEvents = 'auto';
  overlay.style.opacity = '1';
  gamePanel.style.display = 'block';

  // 2. Sembunyikan Konten Teks/Tombol untuk memberi tempat video full-screen
  gamePanel.style.padding = '0'; // HAPUS padding agar video full layar
  textContent.style.display = 'none'; 

  // 3. Tampilkan dan Putar Video
  if (gameoverVideo) {
    gameoverVideo.style.display = 'block';
    gameoverVideo.load(); 
    gameoverVideo.play().catch(e => console.error("Video Play Failed:", e));
    
    // 4. Set Event Listener: Setelah Video Selesai
    gameoverVideo.onended = () => {
      gameoverVideo.style.display = 'none';
      gameoverVideo.onended = null;
      
      // 5. Tampilkan Kembali Konten Teks/Tombol
      gamePanel.style.padding = '22px'; // Kembalikan padding normal
      textContent.style.display = 'block'; 

      // Atur Teks Game Over
      overlayTitle.textContent = 'Game Over! üíî';
      overlayText.textContent = 'Score Akhir: ' + score + ' ‚Ä¢ High: ' + highScore + '. Klik "Mulai" atau Space untuk coba lagi.';
    };
  } else {
    // Jika Video tidak ada/gagal dimuat, langsung tampilkan teks Game Over
    gamePanel.style.padding = '22px';
    textContent.style.display = 'block';

    overlayTitle.textContent = 'Game Over! üíî';
    overlayText.textContent = 'Score Akhir: ' + score + ' ‚Ä¢ High: ' + highScore + '. Klik "Mulai" atau Space untuk coba lagi.';
  }
}

function spawnObstacle(){
  const h = 20 + Math.floor(Math.random()*46);
  const w = 18 + Math.floor(Math.random()*40);
  obstacles.push({x: W + 20, y: groundY - h, w, h, passed:false});
}

function update(dt){
  // LOGIC HITUNGAN MUNDUR
  if (countdown > 0) {
      countdown -= 1;
      if (countdown <= 0) {
          running = true; 
      }
      return; 
  }
  
  if (!running) return;

  // input jump
  if ((keys['Space'] || keys['ArrowUp']) && player.grounded){
    player.vy = -player.jumpPower; player.grounded = false; player.crouch = false;
  }
  player.crouch = !!keys['ArrowDown'] && player.grounded;

  // physics
  if (!player.grounded) player.crouch = false; 
  player.vy += player.gravity; player.y += player.vy;
  if (player.y + player.h >= groundY){ player.y = groundY - player.h; player.vy = 0; player.grounded = true; }

  // speed scaling
  if (score % 100 === 0 && score > 0 && speed < 12) speed = 6 + Math.floor(score / 100) * 0.5;

  // obstacles
  let playerH = player.crouch ? player.h - 12 : player.h;
  let playerY = player.crouch ? player.y + 12 : player.y;

  for (let i = obstacles.length-1; i>=0; i--){
    const o = obstacles[i];
    o.x -= speed;
    if (!o.passed && o.x + o.w < player.x){ score++; o.passed = true; if (scoreEl) scoreEl.textContent = score; }
    if (o.x + o.w < -50) obstacles.splice(i,1);
    
    // Cek tabrakan
    if (rectIntersect(player.x, playerY, player.w, playerH, o.x, o.y, o.w, o.h)){
      gameOver();
    }
  }

  // spawn
  spawnTimer -= 1;
  if (spawnTimer <= 0){ spawnObstacle(); spawnTimer = 60 + Math.floor(Math.random()*(90 - score/200)); }
}

function rectIntersect(x1,y1,w1,h1,x2,y2,w2,h2){
  return !(x2 > x1 + w1 || x2 + w2 < x1 || y2 > y1 + h1 || y2 + h2 < y1);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // sky
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#0a3150'); g.addColorStop(1,'#033046');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  // ground
  ctx.fillStyle = '#052029'; ctx.fillRect(0,groundY, W, H-groundY);
  for (let x=0;x<W;x+=40){ ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(x, groundY+6, 20, 2); }

  // player
  ctx.save();
  ctx.fillStyle = '#ff8a42';
  if (player.crouch){ 
    ctx.fillRect(player.x, player.y + 12, player.w, player.h - 12); 
  }
  else{ 
    ctx.fillRect(player.x, player.y, player.w, player.h); 
  }
  ctx.restore();

  // obstacles
  ctx.fillStyle = '#ff6b6b';
  obstacles.forEach(o => { ctx.fillRect(o.x, o.y, o.w, o.h); });

  // LOGIC GAMBAR HITUNGAN MUNDUR
  if (countdown > 0) {
    const seconds = Math.ceil(countdown / 60); 
    let text = seconds.toString();
    
    if (seconds === 1 && countdown < 60) {
        text = "MULAI!";
    }
    
    ctx.fillStyle = 'rgba(255, 255, 255, 0.95)'; 
    ctx.textAlign = 'center';
    
    ctx.font = 'bold 72px Poppins, Arial'; 
    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
    ctx.shadowBlur = 10;
    
    ctx.fillText(text, W / 2, H / 2 + 20);
    
    ctx.shadowBlur = 0; 
  }
}

// main loop
let last = performance.now();
function loop(now){
  const t = now || performance.now();
  const dt = t - last; last = t;
  // Update dilakukan jika running ATAU sedang countdown
  if (running || countdown > 0){ update(dt); } 
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// initial state: Tampilkan layar "Siap Bermain?"
overlay.style.opacity = '1';
gamePanel.style.display = 'block';
gamePanel.style.padding = '22px'; // Set padding awal
textContent.style.display = 'block'; 
if (gameoverVideo) gameoverVideo.style.display = 'none'; // Sembunyikan video di awal

// responsive canvas resizing
window.addEventListener('resize', () => {
  const maxW = Math.min(1100, window.innerWidth - 40);
  const scale = Math.min(1, maxW / 900);
  canvas.style.width = Math.floor(900 * scale) + 'px';
});
window.dispatchEvent(new Event('resize'));
</script>

</body>
</html>
